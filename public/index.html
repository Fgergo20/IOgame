<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Multiplayer .io Game</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.js"></script>
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>
<script>
const socket = io();

let players = {};
let myId = null;
let cursors;
let speed = 3;

const config = {
    type: Phaser.AUTO,
    width: 800,
    height: 600,
    backgroundColor: "#2d2d2d",
    physics: { default: "arcade" },
    scene: {
        preload: function() {},
        create: function() {
            cursors = this.input.keyboard.createCursorKeys();

            socket.on("currentPlayers", (serverPlayers) => {
                for (let id in serverPlayers) {
                    addPlayer(this, id, serverPlayers[id]);
                }
            });

            socket.on("newPlayer", (player) => {
                addPlayer(this, player.id, player);
            });

            socket.on("playerMoved", (data) => {
                if (players[data.id]) {
                    players[data.id].x = data.x;
                    players[data.id].y = data.y;
                }
            });

            socket.on("playerLeft", (id) => {
                if (players[id]) {
                    players[id].destroy();
                    delete players[id];
                }
            });

            myId = socket.id;
        },
        update: function() {
            if (!players[socket.id]) return;

            let moved = false;
            let player = players[socket.id];

            if (cursors.left.isDown) { player.x -= speed; moved = true; }
            if (cursors.right.isDown) { player.x += speed; moved = true; }
            if (cursors.up.isDown) { player.y -= speed; moved = true; }
            if (cursors.down.isDown) { player.y += speed; moved = true; }

            if (moved) {
                socket.emit("move", { x: player.x, y: player.y });
            }
        }
    }
};

function addPlayer(scene, id, data) {
    let rect = scene.add.rectangle(data.x, data.y, 40, 40, Phaser.Display.Color.HexStringToColor(data.color).color);
    scene.physics.add.existing(rect);
    players[id] = rect;
}

new Phaser.Game(config);
</script>
</body>
</html>
